 #! /usr/bin/env python
# -*- coding: utf-8 -*-

# Setup
#
from snakemake.utils import min_version
from snakemake.exceptions import WorkflowError
from snakemake.exceptions import RuleException

import os
import pandas as pd

min_version("6.4.1")

configfile: "config/config.yaml"

# wildcard constraints
#
wildcard_constraints:
    sra_run = "SRR[0-9]{6,9}",
    dataset = "PRJNA\d+"

# include rules
#
include: "rules/common.smk"
include: "rules/get_fastq_files.smk"
include: "rules/sample_complete.smk"

# build inputs
#
formatted_inputs = [
    "results/{dataset}/complete/{samp}/{samp}_complete.txt".format(dataset=row['project_meta'], samp=index)
    for index, row in meta_table.iterrows()
    if row['assay_meta'] == 'rna_seq'
]

# workflow top rule
#
rule all:
    input:
        formatted_inputs

